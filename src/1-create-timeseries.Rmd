---
title: "Create timeseries from h5 bird profile data"
author: "Peter Desmet"
output: html_notebook
---

```{r}
library(devtools)
library(rhdf5)
library(bioRad)
```

## 1. Installations

Install the following packages via the R Studio console:

### rhdf5

```{r eval=FALSE}
source("https://bioconductor.org/biocLite.R")
biocLite("rhdf5")
```

### bioRad

[Until this pull request](https://github.com/adokter/bioRad/pull/32) is accepted, you need to install bioRad from the `vignettes` branch on ENRAM:

```{r eval=FALSE}
install_github("enram/bioRad", ref="vignettes")
```

## 2. Define your settings

### Local data directory

```{r}
# Where h5 bird profile data are stored locally 
# or where they should be downloaded to:
settings.h5_data_dir <- "../data/raw" 
```

### Time window

```{r}
# Time windows starts at this date (inclusive):
settings.start_date = "2017-03-01"
# Time window ends at this date (inclusive):
settings.end_date = "2017-04-30"
```

### Countries and radars

```{r}
# List of countries (ISO_3166-1 alpha 2) to include:
settings.countries = c("se")
# List of radars (ODIM codes) to include:
settings.radars = c("ang", "kkr")
```

## 3. Download bird profile data

_Ignore this step if you already have all the required bird profile data locally._

Download the data you are interested in from the [ENRAM bird profile data repository](http://enram.github.io/data-repository). Note that this step might take some time.

```{r results = "hide"}
bioRad::download_vp(
  localpath = settings.h5_data_dir,
  start_date = settings.start_date,
  end_date = settings.end_date,
  country = settings.countries,
  radar = settings.radars
)
```

TODO: ideally, the range of radars andshould get input on time window and radars. Example right now is two radars from Sweden for March and April 2017.

## Create timeseries

Create a list of the data files we want to include in the timeseries:

```{r}
list.paths <- bioRad::retrieve_vp_paths(
  path = settings.h5_data_dir,
  start_date = settings.start_date,
  end_date = settings.end_date,
  country = settings.countries
)
```

TODO: decide on radars OR countries (one or the other, see bioRad vignettes).
